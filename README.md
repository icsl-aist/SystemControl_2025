# SystemControl_2025

JupyterLab 環境構築・利用ガイド
# SystemControl_2025 JupyterLab 環境構築・利用ガイド

このガイドでは、Python環境の構築（pyenv経由）、JupyterLabのインストール、および基本的な利用方法について解説します。

## 1. 環境構築 (Pythonのインストール)

`pip` コマンドが使用できない場合や、まだPythonをインストールしていない場合は、以下の手順で `pyenv` を経由してPythonをインストールしてください。

※すでにインストール済みの方は「2. JupyterLabのインストール」へ進んでください。

### 1-1. pyenvのインストール
ターミナルで以下のコマンドを実行し、`pyenv` をインストールします。

```bash
brew install pyenv
```

### 1-2. 初期設定
インストール後、以下のコマンドを順に実行して環境設定ファイル（`.zshrc`）に必要な設定を追記し、読み込みます。

```bash
touch .zshrc
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.zshrc
echo 'command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.zshrc
echo 'eval "$(pyenv init -)"' >> ~/.zshrc
source .zshrc
```

インストール確認のため、以下を実行してバージョンが表示されるか確認してください。

```bash
pyenv -v
```

### 1-3. Pythonのインストールと設定
今回はバージョン 3.13.7 を使用します。

```bash
pyenv install 3.13.7
pyenv global 3.13.7
```

※ pip install jupyterlab 実行時に pip コマンドが見つからないエラーが出た場合も、上記の pyenv global コマンドを実行してください。


## 2. JupyterLabのインストールと起動

### 2-1. インストール
ターミナルで以下のコマンドを実行します。

```bash
pip install jupyterlab
```

### 2-2. 起動
インストール完了後、以下のコマンドでJupyterLabを起動します。

```bash
jupyter lab
```

## 3. JupyterLabの基本的な使い方
フォルダ・ファイルの作成と管理

フォルダ作成: 左上のタブメニューにある「＋」ボタン（左から2番目）を押して新規フォルダを作成します。

名前の変更: 作成されたフォルダを右クリック（トラックパッド2本指クリック）し、メニューから「Rename」を選択して変更します。

ファイル作成: タブメニュー左端の「＋」ボタンを押し、表示されるメニューから「Notebook」の「Python 3」を選択して作成します。

ノートブックの操作

セルの実行: Shift + Return（Enter） 

改行: Return（Enter） 

カーネルの再起動: 上部メニューの右から2番目のボタン（回転矢印）を押すと、変数の状態などがリセットされ、最初の状態に戻ります 。

セルの種類
セル上部のプルダウンメニューから種類を切り替えることができます 。

Code: Pythonプログラムを記述し、実行するためのセル 。

Markdown: メモ、見出し、箇条書きなどの文章を書くためのセル 。

カーネル（Kernel）とは コードセルの内容を受け取り 、計算を実行し 、その結果やグラフを出力エリアに返す  裏方のプログラムです。


## 4. 日本語化（オプション）
JupyterLabを日本語で使用したい場合は、言語パックをインストールします。

JupyterLabが起動している場合は、ターミナルで Control + C を押して一度終了させます 。

以下のコマンドを実行します 。

```bash
pip install jupyterlab jupyterlab-language-pack-ja-JP
```

再度 jupyter lab コマンドで起動します 。


p5.js 倒立振子制御学習支援システム
# SystemControl_2025 p5.js 倒立振子制御学習支援システム

## 1. 概要
本システムは、現代制御理論（状態空間モデル、LQR制御、状態推定）を視覚的・直感的に学習するためのウェブベース教材です。
Python (JupyterLab) による理論設計と、p5.js (JavaScript) による動的シミュレーションを組み合わせることで、数式と物理現象の結びつきを深く理解することを目指しています。

## 2. 教材の構成と学習ステップ
本教材は、以下の4つのステップで構成されています。各HTMLファイルをブラウザで開くか、JupyterLabのIFrame上で実行してください。

| ファイル名 | 学習内容 | 学習のポイント |
| :--- | :--- | :--- |
| **① 倒立振子_FB.html** | 状態フィードバック制御 | Jupyterで設計したゲイン $F$ を入力し、振子が安定化する様子を確認する。 |
| **② 倒立振子_FB_white2.html** | 観測ノイズの導入 | センサノイズと数値微分が合わさることで、制御がいかに不安定になるかを体験する。 |
| **③ 倒立振子_FB_RPSWhite2.html** | ローパスフィルタ(LPF) | ノイズ除去のためにフィルタを強めると、**位相遅れ**によって逆に倒れる現象を学ぶ。 |
| **④ 倒立振子_FB_ka.html** | カルマンフィルタ(KF) | 物理モデルを用いた最適推定により、遅延なくノイズを除去できる現代制御の威力を知る。 |



## 3. 使用方法

### STEP 1：理論設計 (JupyterLab)
1. `倒立振子制御.ipynb` を開き、運動方程式から線形状態空間モデル（$A, B, C, D$ 行列）を導出します。
2. LQR（線形二次レギュレータ）の重み行列 $Q, R$ を調整し、フィードバックゲイン $F$ を算出します。

### STEP 2：シミュレーション (Webブラウザ/p5.js)
1. 各HTMLの「Gain」欄に、Jupyterで求めたゲイン $F_1, F_2, F_3, F_4$ を入力します。
2. リセットボタンを押し、振子が目標位置（真上）に収束するまでのグラフの滑らかさと速さを観察します。
3. ノイズ（Real Noise）やフィルタ定数（$Q, R$）を変更し、推定精度と安定性のトレードオフを確認します。

## 4. 画面の見方

### コントロールパネル
- **Gain (F1-F4)**: LQR等で設計したフィードバックゲイン。
- **Real Noise (σ)**: 現実のセンサを模した白色ノイズの強度。
- **KF Tuning (Q, R)**: カルマンフィルタの信頼度（$Q$:モデルの信頼性, $R$:センサの信頼性）。

### リアルタイムグラフ
- **緑色の線 (True)**: シミュレーション上の「真の物理状態」。
- **橙色の線 (Observed)**: ノイズが乗ったままの「センサ計測値」。
- **青色の線 (Estimate)**: フィルタリングされた「推定値」。



## 5. 注意事項
* **線形近似の限界**: 本教材の制御設計（Jupyter）は線形近似に基づいています。そのため、振子が大きく傾きすぎると（非線形な影響が大きくなると）、p5.js上の振子は倒れてしまいます。これは「理論の限界」を学ぶための意図的な仕様です。
* **数値微分**: 速度を計測値の差分（数値微分）で求めるとノイズが激しく増幅されます。カルマンフィルタを用いることで、この問題を解決できることを確認してください。

---

## 開発・クレジット
* **所属**: 知的制御研究室
* **開発環境**: Python 3.x, p5.js v1.6.0
* **開発者**: 加藤吾蓮 (k22033)